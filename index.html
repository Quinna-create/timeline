<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+JP:700|Roboto:400,700&display=swap" rel="stylesheet">
    <title>Vertical Shinsengumi Timeline</title>
    <script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: black;
            color: white;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .timeline-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 50px auto;
            padding: 20px 0;
        }
        .vertical-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: white;
            transform: translateX(-50%);
            height: auto;
            z-index: 1;
        }
        .dot {
    position: absolute;
    left: 50%;
    width: 18px;
    height: 18px;
    background: radial-gradient(circle at 60% 40%, #d3c5aa 60%, #a89c82 100%);
    border: 2px solid #8c7e58;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
    box-shadow: 0 1px 4px rgba(100, 80, 40, 0.10);
}
        .year-label {
    position: absolute;
    left: 50%;
    transform: translate(-50%, -50%);
    background: 
         linear-gradient(135deg, #f3e9d2 60%, #bfae8e 100%),
         url('https://www.transparenttextures.com/patterns/old-mathematics.png');
    background-blend-mode: multiply;
    color: #584e36;
    border-radius: 26px;
    padding: 12px 32px;
    font-weight: normal;
    border: none; /* No border */
    z-index: 3;
    box-shadow: 0 2px 8px rgba(100, 80, 40, 0.1);
    white-space: nowrap;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: 'Noto Sans JP', 'Roboto', Arial, sans-serif;
    
}
.kanji-year {
    font-family: 'Noto Serif JP', serif;
    font-weight: bold;
    font-size: 1.7em;
    color: #bba14f; /* Muted gold */
    margin-bottom: 2px;
    letter-spacing: 1px;
}
.romaji-year {
    font-size: 1em;
    color: #8c7e58;
    margin-bottom: 1px;
}
.western-year-label {
    font-size: 0.85em;
    color: #b4a078;
    margin-top: 2px;
}
        .date-string {
    font-size: 1.1em;
    font-weight: bold;
    color: #bfae8e;
    margin-bottom: 6px;
    letter-spacing: 0.5px;
    font-family: 'Noto Serif JP', serif;
}
        .timeline .dot { }
        .event {
            clear: both;
            background: transparent;
            border: none; 
            border-radius: 0;
            overflow: visible;
            position: relative;
            margin: 30px 0;
            width: calc(50% - 160px);
            opacity: 0;
            transform: translateX(400px);
            transition: opacity 0.7s ease-out, transform 0.7s ease-out;
        }
        .event.left {
            float: left;
            text-align: right;
            margin-right: 160px;
        }
        .event.right {
            float: right;
            text-align: left;
            margin-left: 160px;
        }
        .event.visible {
            opacity: 1;
            transform: translateX(0);
        }
        .event.hidden {
            opacity: 0;
            transform: translateX(500px);
        }
        .event.right.hidden {
            transform: translateX(-500px);
        }
        .event.left.hidden {
            transform: translateX(500px);
        }
        .event-content {
            padding: 10px;
            background: #3a3a3a;
            border-radius: 10px;
            box-shadow: 3px 3px 6px rgba(255, 255, 255, 0.2);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .event:hover .event-content {
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }
        
        .description {
            font-size: 16px;
            line-height: 1.6;
        }
        .clearfix::after {
            content: '';
            display: table;
            clear: both;
        }
    </style>
</head>
<body>
   <div class="timeline-container">
      <div class="vertical-line"></div>
      <div class="timeline" role="list" aria-label="Shinsengumi Timeline"></div>
   </div>
   <script>
document.addEventListener("DOMContentLoaded", function () {
    const timeline = document.querySelector(".timeline");
    const events = [
  {
    year: 1849,
    japaneseKanji: "嘉永2年",
    japaneseRomaji: "Kaei 2",
    chapter: 6,
    description: "Kondō Isami (16 years old) adopted by Shūsuke as heir to the Tennen Rishin sword fighting school",
  },
  {
    year: 1861, month: 2, day: 19,
    japaneseKanji: "文久元年",
    japaneseRomaji: "Bunkyū 1",
    chapter: 6,
    description: "Stuff happens on this day",
  },
  {
    year: 1862,
    japaneseKanji: "文久2年",
    japaneseRomaji: "Bunkyū 2",
    chapter: 6,
    description: "Hijikata Toshizō and everyone else joins Roshi Corps",
  },
  {
    year: 1863, month: 1,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 6,
    description: "Kondō purchases the \"Kotetsu\" sword",
  },
  {
    year: 1863, month: 2, day: 4,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 2,
    description: "recruits from Edo meet each other at Dentsū temple",
  },
  {
    year: 1863, month: 4, day: 13,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 1,
    description: "Kiyokawa Hachirō assassinated at the Akabane Bridge in Kyoto",
  },
  {
    year: 1863, month: 4,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 12,
    description: "",
  },
  {
    year: 1863, month: 4,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: null,
    description: "",
  },
  {
    year: 1863, month: 3,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 11,
    description: "Hijikata first suspects Okita has TB",
  },
  {
    year: 1863, month: 3,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 6,
    description: "Shinsengumi officially inaugurated",
  },
  {
    year: 1863, month: 4, day: 13,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 1,
    description: "assasination of Kiyokawa Hachirō",
  },
  {
    year: 1863, month: 8,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 8,
    description: "Hamaguri Gate Incident",
  },
  {
    year: 1863, month: 8, day: 14,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 2,
    description: "Serizawa incident with Sumo wrestlers",
  },
  {
    year: 1863, month: 9, day: 18,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 2,
    description: "assassination of Serizawa",
  },
  {
    year: 1863, month: 12,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 3,
    description: "Fukamachi Shinsaku’s first kill",
  },
  {
    year: 1863, month: 12,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 5,
    description: "Takeda and Yamazaki Susumu join Shinsengumi",
  },
  {
    year: 1864, month: 1, day: 1,
    japaneseKanji: "元治元年",
    japaneseRomaji: "Genji 1",
    chapter: 4,
    description: "Yamazaki returns to his dojo in Osaka to offer New Year's greetings to his master after having joined the Shinsengumi.",
  },
  {
    year: 1864, month: 6, day: 4,
    japaneseKanji: "元治元年",
    japaneseRomaji: "Genji 1",
    chapter: 4,
    description: "Yamazaki reports Masuya to Shinsengumi Fukamachi Shinsaku killed and discovery of the note leading to Ikedaya raid",
  },
  {
    year: 1864, month: 6, day: 5,
    japaneseKanji: "元治元年",
    japaneseRomaji: "Genji 1",
    chapter: 4 & 8,
    description: "Ikedaya Incident, chp 4 & chp 8; organizational structure redrawn, corporal becomes sergent;",
  },
  {
    year: 1864, month: 8, day: 18,
    japaneseKanji: "元治元年",
    japaneseRomaji: "Genji 1",
    chapter: 4,
    description: "Chōshū sympathizers forced out of Kyoto back to Choshu, overturning Choshu’s powerful position in the capital",
  },
  {
    year: 1863, month: 9,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 1,
    description: "Itō Kashitarō leads a group of followers, including Shinohara Tainoshin, from his dojo in Edo to join the Shinsengumi in Kyoto",
  },
  {
    year: 1863, month: 6,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 3,
    description: "Chrysanthemum festival, Shinsaku meets at Shikokuya Inn",
  },
  {
    year: 1863, month: 10,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 3,
    description: "Chrysanthemum festival, Shinsaku meets at Shikokuya Inn",
  },
  {
    year: 1863, month: 12, day: 3,
    japaneseKanji: "文久3年",
    japaneseRomaji: "Bunkyū 3",
    chapter: 3,
    description: "Shinsaku kills for the first time in raid at the Baishoin temple",
  },
  {
    year: 1865, month: 3,
    japaneseKanji: "元治2年",
    japaneseRomaji: "Genji 2",
    chapter: 7,
    description: "Shinsengumi moves headquarters from Mibu to Nishi Honganji; Sosaburo and Tashiro join the corps",
  },
  {
    year: 1865,
    japaneseKanji: "慶応元年",
    japaneseRomaji: "Keiō 1",
    chapter: 13,
    description: "Yahei engages in personal fight, killing Sakura",
  },
  {
    year: 1865, month: 1,
    japaneseKanji: "慶応元年",
    japaneseRomaji: "Keiō 1",
    chapter: 8,
    description: "Shikanai’s child born, (does not line up with rest of timeline in the chp)",
  },
  {
    year: 1866, month: 1, day: 2,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 8,
    description: "Okubo and Ito have a secret meeting at Ichiriki in Gion Hanamikoji cementing their alliance before Ito’s departure from Shinsengumi",
  },
  {
    year: 1866, month: 1,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 7,
    description: "middle of 1st month, Ohayashi Hyogo arrives at headquarters",
  },
  {
    year: 1866, month: 1, day: 29,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 10,
    description: "Nakakura Shuzen discovered to have been attacked",
  },
  {
    year: 1867, month: 2, day: 25,
    japaneseKanji: "慶応3年",
    japaneseRomaji: "Keiō 2",
    chapter: 1,
    description: "Tainoshin agrees to leave Shinsengumi with the Itō faction",
  },
  {
    year: 1866, month: 3, day: 13,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 1,
    description: "Tainoshin gets involved in a fight defending Suzuki Mikisaburō. The fallout from this minor scuffle kicks off a series of events which ends in the Goryo Eiji Incident, an intra-party split within the Shinsengumi",
  },
  {
    year: 1866, month: 4, day: 1,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 12,
    description: "Tani Sajūrō is defeated in combat",
  },
  {
    year: 1866, month: 8, day: 29,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 8,
    description: "placard thrown into Kamo river with the notice board incident",
  },
  {
    year: 1866, month: 9, day: 26,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 13,
    description: "26th day of 9th month Itō broaches the idea of splitting from the corps with Kondo",
  },
  {
    year: 1866, month: 9, day: 28,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 3",
    chapter: 5,
    description: "Takeda Kanryūsai’s is executed by Saitō Hajime on a toll bridge over the Kamo River",
  },
  {
    year: 1866, month: 10, day: 12,
    japaneseKanji: "慶応2年",
    japaneseRomaji: "Keiō 2",
    chapter: 13,
    description: "Hirano Kazumi attacks Tomiyama Yahei by the Yugyo temple on Shichijo Avenue",
  },
  {
    year: 1867, month: 3, day: 10,
    japaneseKanji: "慶応3年",
    japaneseRomaji: "Keiō 3",
    chapter: 1,
    description: "Itō faction leaves for Choenji Temple",
  },
  {
    year: 1867, month: 6,
    japaneseKanji: "慶応3年",
    japaneseRomaji: "Keiō 3",
    chapter: 1,
    description: "After several months of discussions, the Shogunate grants samurai status to members of the Shinsengumi",
  },
  {
    year: 1867, month: 6, day: 8,
    japaneseKanji: "慶応3年",
    japaneseRomaji: "Keiō 3",
    chapter: 1,
    description: "Itō faction (along with Tainoshin) moved to Gesshin-in Temple",
  },
  {
    year: 1867, month: 11, day: 18,
    japaneseKanji: "慶応3年",
    japaneseRomaji: "Keiō 3",
    chapter: 1,
    description: "Itō is assassinated at Aburanokoji",
  },
  {
    year: 1868, month: 1, day: 3,
    japaneseKanji: "慶応4年",
    japaneseRomaji: "Keiō 4",
    chapter: 14,
    description: "Battle of Toba-Fushimi, after which the Shinsengumi is driven out of Kyoto",
  }
];

          // Sort events by year, month, day
    events.sort((a, b) => {
        if (a.year !== b.year) return a.year - b.year;
        if ((a.month || 0) !== (b.month || 0)) return (a.month || 0) - (b.month || 0);
        return (a.day || 0) - (b.day || 0);
    });

    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    entry.target.classList.remove("hidden");
                } else {
                    entry.target.classList.add("hidden");
                    entry.target.classList.remove("visible");
                }
            });
        },
        { rootMargin: "300px", threshold: 0.05 }
    );

    let lastYear = null;
    const eventDivs = [];
    const dots = [];
    const yearLabels = [];

       function getLunarDateString(event) {
    const dayStr = event.day ? `the ${event.day}${getOrdinalSuffix(event.day)} day` : '';
    const monthStr = event.month ? `the ${event.month}${getOrdinalSuffix(event.month)} lunar month` : '';
    if (event.day && event.month) {
        return `${dayStr} of ${monthStr}`;
    } else if (event.day) {
        return dayStr;
    } else if (event.month) {
        return monthStr;
    } else {
        return ''; // No date
    }
}

function getOrdinalSuffix(n) {
    if (n > 10 && n < 20) return 'th';
    switch (n % 10) {
        case 1:  return 'st';
        case 2:  return 'nd';
        case 3:  return 'rd';
        default: return 'th';
    }
}
    events.forEach((event, index) => {
        // Insert year label if it's a new year
        if (event.year !== lastYear) {
            const yearDiv = document.createElement("div");
            yearDiv.className = "year-label";
            yearDiv.innerHTML = `
  <div class="kanji-year">${event.japaneseKanji}</div>
  <div class="romaji-year">${event.japaneseRomaji}</div>
  <div class="western-year-label">${event.year}</div>
`;
            timeline.appendChild(yearDiv);
            yearLabels.push(yearDiv);
            lastYear = event.year;
        }

        const eventDiv = document.createElement("div");
        eventDiv.className = `event ${index % 2 === 0 ? "left" : "right"} hidden`;

             const lunarDate = getLunarDateString(event);
            eventDiv.innerHTML = `
              <div class="event-content">
              ${lunarDate ? `<div class="date-string">${lunarDate}</div>` : ""}
            <div class="description">${event.description}</div>
          </div>
            `;

        timeline.appendChild(eventDiv);
        observer.observe(eventDiv);

        const dot = document.createElement("div");
        dot.className = "dot";
        timeline.appendChild(dot);
        eventDivs.push(eventDiv);
        dots.push(dot);
    });

    // Position dots and year labels
    function positionAll() {
    // Dots
    eventDivs.forEach((eventDiv, i) => {
        dots[i].style.top = (eventDiv.offsetTop + eventDiv.offsetHeight / 2) + "px";
    });

    // Year labels
    let eventIdx = 0;
    let lastYearBottom = 0;
    const yearLabelBuffer = 16; // px between year ovals

    yearLabels.forEach((yearDiv, i) => {
        // Find the first event after this year label
        let found = false;
        for (; eventIdx < eventDivs.length; eventIdx++) {
            if (eventDivs[eventIdx].previousSibling === yearDiv) {
                found = true;
                break;
            }
        }
        // Default: position above associated event dot
        let y = (eventDivs[eventIdx] ? eventDivs[eventIdx].offsetTop : 0) - 60;
        // Prevent year label from going off top
        if (y < 8) y = 8;
        // If this year label would overlap the previous, push it down
        if (i > 0) {
            const minTop = lastYearBottom + yearLabelBuffer;
            if (y < minTop) y = minTop;
        }
        yearDiv.style.top = y + "px";
        lastYearBottom = y + yearDiv.offsetHeight;
    });
}

    setTimeout(positionAll, 0);
    window.addEventListener('resize', positionAll);
    window.addEventListener('load', positionAll);

    // Adjust vertical line height
    function adjustVerticalLineHeight() {
        const verticalLine = document.querySelector('.vertical-line');
        if (timeline && verticalLine) {
            verticalLine.style.height = timeline.scrollHeight + 'px';
        }
    }
    adjustVerticalLineHeight();
    window.addEventListener('resize', adjustVerticalLineHeight);
});
   </script>
</body>
</html>

